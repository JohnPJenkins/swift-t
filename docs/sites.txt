
:toc:

Turbine Sites Guide
===================
Justin M. Wozniak <wozniak@mcs.anl.gov>
v0.0.7, December 2012

////

This file is on the web at:

http://www.mcs.anl.gov/exm/local/guides/turbine-sites.html

////

== Overview

This manual provides an index of sites maintained by the Swift/T team
for use by Turbine.

For each machine, a *public installation* and/or a *build procedure* will
be provided.  The user need only follow one set of directions.

To follow a build procedure, you may start with the +exm+ download
package.  Simply edit the +exm-setup+ script and modify the
configuration settings as described here.

See the link:./stc.html[Swift/T Guide] for more information

== x86 clusters

=== Midway

Midway is a mid-sized SLURM cluster at the University of Chicago

==== Public installation

* Based on trunk
* STC: +~wozniak/Public/stc/bin/stc+

To run:

----
srun ~wozniak/Public/turbine/scripts/submit/slurm/turbine-slurm.sh -n 3 ~/program.tcl
----

==== Build procedure

* Midway uses OpenMPI.  We have tested with +/software/openmpi-1.6-el6-x86_64+
* Put +mpicc+ in your +PATH+
* Configure ADLB with:
+
----
CC=mpicc LDFLAGS="-Wl,-rpath -Wl,/software/openmpi-1.6-el6-x86_64/lib"
----
* Configure Turbine with:
+
----
 --with-mpi-lib-name=mpi
----

== Blue Gene

=== Blue Gene/P

==== Surveyor/Intrepid/Challenger

These machines are at the Argonne Leadership Computing Facility (ALCF).

*To run on the login nodes (initial debugging):*

* Install MPICH for the compute nodes
* Configure Tcl and c-utils with gcc
* Configure ADLB with your MPICH
* Configure Turbine with
+
----
--enable-bgp LDFLAGS=-shared-libgcc
----
+
This makes adjustments for some Blue Gene quirks.

Then, simply use the +bin/turbine+ program to run.  Be cautious in
your use of the login nodes to avoid affecting other users.

*To run on the compute nodes:*

* Configure Tcl with mpixlc
* Configure c-utils with gcc
* Configure ADLB with
+
----
--enable-xlc
CC=/bgsys/drivers/ppcfloor/comm/bin/mpixlc
----
* Configure Turbine with
+
----
CC=/soft/apps/gcc-4.3.2/gnu-linux/bin/powerpc-bgp-linux-gcc
--enable-custom
--with-mpi-include=/bgsys/drivers/V1R4M2_200_2010-100508P/ppc/comm/default/include
----

To run, use +scripts/submit/bgp/turbine-cobalt.zsh+
See the script header for usage.

== Cray

=== Beagle

Beagle is a Cray XE6 at the University of Chicago

Remember that at run time, Beagle jobs can access only +/lustre+, not
NFS (including home directories).  Thus, you must install Turbine and
its libraries in +/lustre+.  Also, your data must be in +/lustre+.

==== Public installation

* Based on trunk
* Turbine: +/lustre/beagle/wozniak/Public/turbine/bin/turbine+
* STC: +~wozniak/Public/stc/bin/stc+

To run:

1. Copy out the sample submit script:
+/lustre/beagle/wozniak/Public/turbine/scripts/submit/cray/aprun.sh+
2. Edit and submit with +qsub+.

==== Build procedure

* Configure ADLB with:
+
----
./configure --prefix=/path/to/lb --with-c-utils=/path/to/c-utils
CC=gcc
CFLAGS=-I/opt/cray/mpt/default/xt/gemini/mpich2-gnu/include
LDFLAGS="-L/opt/cray/mpt/default/xt/gemini/mpich2-gnu/lib -lmpich"
----
+
* In the Turbine configure step, replace the +--with-mpi+ option with:
+
----
--enable-custom-mpi --with-mpi=/opt/cray/mpt/default/xt/gemini/mpich2-gnu
----

=== Crow

Crow is a Cray XT at Cray

==== Build procedure

* Configure ADLB with:
+
----
./configure --prefix=/path/to/lb --with-c-utils=/path/to/c-utils
CC=gcc
CFLAGS=-I/opt/cray/mpt/5.3.0/xt/seastar/mpich2-gnu/include
LDFLAGS="-L/opt/cray/mpt/5.3.0/xt/seastar/mpich2-gnu/lib -lmpich"
----
+
* In the Turbine configure step, replace the +--with-mpi+ option with:
+
----
--enable-custom --with-mpi-dir=/opt/cray/mpt/5.3.0/xt/seastar/mpich2-gnu
----

To run:

1. Copy out the sample submit script:
+turbine/scripts/submit/cray/aprun.sh+
2. Edit and submit with +qsub+.

== Cloud

=== EC2

==== Setup

* Install http://instagram-engineering.tumblr.com/post/11399488246/simplifying-ec2-ssh-connections[+ec2-host+] on your local system
* Launch EC2 instances.
** Enable SSH among instances.
** Firewall settings must allow all all TCP/IP traffic for MPICH to run.
** If necessary, install Swift/T
** An AMI with Swift/T installed is available
* Use the provided script +turbine/scripts/submit/ec2/turbine-setup-ec2.zsh+.
** See the script header for usage notes
** This will configure SSH settings and create a hosts file for MPICH
   and install them on the EC2 instance

To run:
----
export TURBINE_LAUNCH_OPTS="-f $HOME/hosts.txt"
turbine program.tcl
----

////
Local Variables:
mode: doc
End:
////
